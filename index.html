<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Full Tracker</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f4f6f9;
}

h2 {
    margin-top: 40px;
}

.section {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

input, button {
    padding: 8px;
    margin: 5px 0;
}

button {
    cursor: pointer;
}

.item {
    display: flex;
    justify-content: space-between;
    margin-top: 5px;
    padding: 5px;
    background: #f1f1f1;
    border-radius: 5px;
}

.delete-btn {
    background: red;
    color: white;
    border: none;
    padding: 3px 8px;
}
</style>
</head>

<body>

<h1>Daily Full Tracker</h1>

<!-- ================= FOOD ================= -->
<div class="section">
    <h2>Food Tracker</h2>
    <input id="foodName" placeholder="Food name">
    <input id="foodCalories" type="number" placeholder="Calories">
    <button id="addFoodBtn">Add Food</button>
    <div id="foodList"></div>
</div>

<!-- ================= EXPENSE ================= -->
<div class="section">
    <h2>Expense Tracker</h2>
    <input id="expenseName" placeholder="Expense name">
    <input id="expenseAmount" type="number" placeholder="Amount">
    <button id="addExpenseBtn">Add Expense</button>
    <div id="expenseList"></div>
</div>

<!-- ================= TODO ================= -->
<div class="section">
    <h2>Todo List</h2>
    <input id="todoInput" placeholder="New task">
    <button id="addTodoBtn">Add Task</button>
    <div id="todoList"></div>
</div>

<script>
// ======================================================
// 1. GLOBAL APP OBJECT
// ======================================================

const App = {
    state: {},
    utils: {},
    modules: {}
};

// ======================================================
// 2. STATE
// ======================================================

App.state = {
    currentDate: new Date().toISOString().split("T")[0],
    food: {},
    expenses: {},
    todos: {}
};

// ======================================================
// 3. UTILITIES
// ======================================================

App.utils.save = function () {
    localStorage.setItem("dailyTracker", JSON.stringify(App.state));
};

App.utils.load = function () {
    const saved = localStorage.getItem("dailyTracker");
    if (saved) {
        App.state = JSON.parse(saved);
    }
};

App.utils.formatCurrency = function (amount) {
    return "Rp " + Number(amount).toLocaleString("id-ID");
};

// ======================================================
// 4. FOOD MODULE
// ======================================================

App.modules.food = {

    add(name, calories) {
        const date = App.state.currentDate;
        if (!App.state.food[date]) App.state.food[date] = [];

        App.state.food[date].push({ name, calories });
        this.render();
        App.utils.save();
    },

    delete(index) {
        const date = App.state.currentDate;
        App.state.food[date].splice(index, 1);
        this.render();
        App.utils.save();
    },

    render() {
        const container = document.getElementById("foodList");
        container.innerHTML = "";
        const date = App.state.currentDate;
        const data = App.state.food[date] || [];

        data.forEach((item, index) => {
            const div = document.createElement("div");
            div.className = "item";
            div.innerHTML = `
                <span>${item.name} - ${item.calories} kcal</span>
                <button class="delete-btn" onclick="App.modules.food.delete(${index})">X</button>
            `;
            container.appendChild(div);
        });
    }
};

// ======================================================
// 5. EXPENSE MODULE
// ======================================================

App.modules.expense = {

    add(name, amount) {
        const date = App.state.currentDate;
        if (!App.state.expenses[date]) App.state.expenses[date] = [];

        App.state.expenses[date].push({ name, amount });
        this.render();
        App.utils.save();
    },

    render() {
        const container = document.getElementById("expenseList");
        container.innerHTML = "";
        const date = App.state.currentDate;
        const data = App.state.expenses[date] || [];

        data.forEach(item => {
            const div = document.createElement("div");
            div.className = "item";
            div.innerHTML = `
                <span>${item.name} - ${App.utils.formatCurrency(item.amount)}</span>
            `;
            container.appendChild(div);
        });
    }
};

// ======================================================
// 6. TODO MODULE
// ======================================================

App.modules.todo = {

    add(text) {
        const date = App.state.currentDate;
        if (!App.state.todos[date]) App.state.todos[date] = [];

        App.state.todos[date].push({ text, done: false });
        this.render();
        App.utils.save();
    },

    toggle(index) {
        const date = App.state.currentDate;
        App.state.todos[date][index].done =
            !App.state.todos[date][index].done;
        this.render();
        App.utils.save();
    },

    render() {
        const container = document.getElementById("todoList");
        container.innerHTML = "";
        const date = App.state.currentDate;
        const data = App.state.todos[date] || [];

        data.forEach((item, index) => {
            const div = document.createElement("div");
            div.className = "item";
            div.innerHTML = `
                <span style="text-decoration:${item.done ? "line-through" : "none"}">
                    ${item.text}
                </span>
                <button onclick="App.modules.todo.toggle(${index})">âœ”</button>
            `;
            container.appendChild(div);
        });
    }
};

// ======================================================
// 7. AI MODULE (PREPARED)
// ======================================================

App.modules.ai = {

    async analyzeFoodImage(file) {
        console.log("AI Food Analysis placeholder");
    },

    async analyzeReceipt(file) {
        console.log("AI Receipt placeholder");
    }
};

// ======================================================
// 8. INIT
// ======================================================

document.addEventListener("DOMContentLoaded", () => {

    App.utils.load();

    document.getElementById("addFoodBtn").addEventListener("click", () => {
        const name = document.getElementById("foodName").value;
        const calories = document.getElementById("foodCalories").value;
        if (!name || !calories) return;
        App.modules.food.add(name, calories);
    });

    document.getElementById("addExpenseBtn").addEventListener("click", () => {
        const name = document.getElementById("expenseName").value;
        const amount = document.getElementById("expenseAmount").value;
        if (!name || !amount) return;
        App.modules.expense.add(name, amount);
    });

    document.getElementById("addTodoBtn").addEventListener("click", () => {
        const text = document.getElementById("todoInput").value;
        if (!text) return;
        App.modules.todo.add(text);
    });

    App.modules.food.render();
    App.modules.expense.render();
    App.modules.todo.render();
});
</script>

</body>
</html>
